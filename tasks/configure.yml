---

- name: Configure Nginx
  sudo: yes
  template:
    src: "{{item}}"
    dest: "{{nginx_conf_dir}}/{{item}}"
  with_items:
    - nginx.conf
    - fastcgi_params
  notify: restart nginx
  tags:
    - nginx
    - frontend
    - conf

- name: Configure Nginx
  sudo: yes
  copy:
    src: "{{item}}"
    dest: "{{nginx_conf_dir}}/{{item}}"
  with_items:
    - mime.types
  notify: restart nginx
  tags:
    - nginx
    - frontend
    - conf

- include: site.yml
  site: "{{nginx_default_site_name}}"
  template: default-site
  when: nginx_create_default_site

- name: Add status site for monitoring
  sudo: yes
  copy: src=status-site dest={{nginx_available_sites_dir}}/status-site
  notify: reload nginx
  when: nginx_create_status_site

- name: Activate status site for monitoring
  sudo: yes
  file: src={{nginx_available_sites_dir}}/status-site dest={{nginx_enabled_sites_dir}}/status-site state=link
  notify: reload nginx
  when: nginx_create_status_site
